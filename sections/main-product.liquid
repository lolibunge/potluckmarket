{% schema %}
{
  "name": "Product Section",
  "class": "section-main-product",
  "tag": "section",
  "settings": [
    {
      "type": "radio",
      "id": "picker_type",
      "label": "Variant Picker Type",
      "options": [
        {
          "value": "radio",
          "label": "Radio Buttons"
        },
        {
          "value": "select",
          "label": "Select Dropdowns"
        }
      ],
      "default": "radio"
    }
  ]
}
{% endschema %}


<div
  class="shopify-section-main-product-inner"
  data-handle="{{ product.handle }}"
  data-id="{{ product.id }}"
  data-url="{{ product.url }}"
  data-section="{{ section.id }}"
  data-prodify="{{ section.settings.picker_type }}"
>
  <script type="application/json" data-prodify-variants-json>
    {{ product.variants | json }}
  </script>

  <a class="skip-to-content-link" href="#product-info-{{ section.id }}"> Skip to product info </a>
  <div class="grid grid-cols-2 pdp-main" style="position: relative;">
    <div
      class="relative w-full col-span-2 md:col-span-1 product-media"
      data-prodify-media-container
    >
      <div class="sticky top-[var(--nav-height)] w-full h-full carousel max-h-[calc(100vh-var(--nav-height))]">
        <span class="sr-only" style="position: absolute; top: 0; left: 0; z-index: 1; font-size: 10px;">
          {{ product.selected_or_first_available_variant.id }}
        </span>
        <div class="relative h-full slides swiper carousel-swiper">
          <div class="relative swiper-wrapper">
            {% for media in product.images %}
              <div class="relative slide aspect-square swiper-slide">
                <div class="media cover">
                  <img
                    src="{{ media | image_url }}"
                    alt="{{ media.alt }}"
                    srcset="{{ media | image_url: width: 1000 }} 800w, {{ media | image_url: width: 1000 }} 1000w, {{ media | image_url: width: 1426 }} 1426w"
                    sizes="(min-width: 830px) 55vw, 100vw"
                    height="{{ media.height }}"
                    width="{{ media.width }}"
                    class="absolute object-cover w-full h-full"
                    loading="eager"
                  >
                </div>
              </div>
            {% endfor %}
          </div>
          {% if product.images.size > 1 %}
            <div class="flex mx-auto swiper-pagination type--eyebrow md:ml-auto md:mr-6"></div>

            <button class="mx-auto  md:hidden pointer-events-auto swiper-button-prev text-[40px] absolute top-1/2 -translate-y-1/2 left-4 z-10 hidden md:block">
              ←
            </button>
            <button class="mx-auto  md:hidden pointer-events-auto swiper-button-next text-[40px] absolute top-1/2 -translate-y-1/2 right-4 z-10 hidden md:block">
              →
            </button>
          {% endif %}
        </div>
        <h1 class="relative z-50 text-4xl sr-only">
          {{ product.selected_or_first_available_variant.options }}
        </h1>

      </div>
    </div>
    <div class="col-span-2 md:col-span-1 info" id="product-info-{{ section.id }}">
      <div class="sticky top-[var(--header-height)] py-[40px]">
        <div class="mb-[35px] type px-[20px] md:px-[100px] xl:max-w-[1000px] mx-auto">SHOP</div>
        <div class="mb-[35px] type px-[20px] md:px-[100px] xl:max-w-[1000px] mx-auto product-title">{{product.title}}</div>
        <div class="px-[20px] md:px-[100px] xl:max-w-[1000px] mx-auto">
          <div class="flex items-center justify-between">
            <div class="quantity-row" data-quantity>
              Quantity: 
            </div>
            <div class="flex items-center py-2 text-15px gap-1" data-prodify-price-container>
              <span class="sr-only">Regular Price</span>
              <span>
                {{ product.selected_or_first_available_variant.price | money }}
              </span>
              {% if product.selected_or_first_available_variant.compare_at_price %}
                <span class="line-through">
                  {{ product.selected_or_first_available_variant.compare_at_price | money }}
                </span>
              {% endif %}
            </div>
          </div>

          {% render 'product-variant-picker',
            product: product,
            product_form_id: 'product-form-id',
            picker_type: section.settings.picker_type
          %}

          <div class="description rte">
            {{ product.description }}
          </div>
          {% if product.metafields.potluck.featured_review != '' %}
            <div class="py-8 my-8 text-center border-t border-b quote">
              <div class="type--h2">{{ product.metafields.potluck.featured_review | newline_to_br }}</div>
            </div>
          {% endif %}

          <ajax-cart-product-form>
            <form
              action="{{ routes.cart_add_url }}"
              id="product_form_id"
              class="product-form"
              novalidate="novalidate"
              data-prodify-product-form
            >
              <input
                type="hidden"
                name="id"
                value="{{ product.selected_or_first_available_variant.id }}"
              >
              <input
                type="hidden"
                name="quantity"
                value="1"
              >
              <div class="mb-[10px]">
                <button
                  type="submit"
                  name="add"
                  class="block w-full text-center cursor-pointer button--add-to-cart disabled:cursor-default disabled:bg-gray-200 disabled:text-black"
                  {% if product.selected_or_first_available_variant.available == false %}
                    disabled
                  {% endif %}
                >
                  <span class="[[processing]_&]:hidden mx-auto type--h2">
                    {%- if product.selected_or_first_available_variant.available -%}
                      Add to Cart
                    {%- else -%}
                      Sold out
                    {%- endif -%}
                  </span>
                  <span class="hidden [[processing]_&]:block mx-auto type--h2"> Adding to cart... </span>
                </button>
              </div>
              <div data-ajax-cart-errors="form"><!-- Error messages appear here --></div>
              {% comment %}
                {%- if product.selected_or_first_available_variant.available -%}
                <a
                type="button"
                class="flex items-center justify-center w-full h-12 px-6 text-white bg-indigo-900 hover:after:border-offset-1"
                :href="`/cart/${selectedVariant}:1`"
                x-show="showBuyNow"
                >
                Buy it now
                </a>
                {%- endif -%}
              {% endcomment %}
            </form>
          </ajax-cart-product-form>

          <!-- HC - 11 Jul '24 - SPI project -->
          {% capture temp %}
            {% form 'product', product %}
               {% capture product_spi %}
                 <div class="hc-shop-pay--product-installments" style="text-align: center; margin: 20px 0 0;">
                   {{ form | payment_terms }}
                 </div>
               {% endcapture %}
             {% endform %}
          {% endcapture %}
          {{ product_spi }}
          
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  const quantityRow = document.querySelector('[data-quantity]');

  // Function to update the quantity based on the selected variant
  function updateQuantity(initial = false) {
    const variantRadios = document.querySelectorAll('[data-prodify-variant-radio]');
    const variantSelect = document.querySelector('[data-prodify-variant-select]');
    let selectedValue = null;

    // Check for the initially selected radio button
    if (variantRadios.length) {
      const selectedRadio = document.querySelector('[data-prodify-variant-radio]:checked');
      if (selectedRadio) {
        selectedValue = selectedRadio.value;
      }
    }

    // Check for the initially selected dropdown value
    if (variantSelect) {
      selectedValue = variantSelect.value;
    }

    // Update the quantity row if a value is found
    if (selectedValue) {
      quantityRow.textContent = `Quantity: ${selectedValue}`;
      if (initial) {
        console.log(`Initialized with Quantity: ${selectedValue}`);
      }
    }
  }

  // Run the function once on page load to initialize
  updateQuantity(true);

  // Add event listeners for changes
  const variantRadios = document.querySelectorAll('[data-prodify-variant-radio]');
  if (variantRadios.length) {
    variantRadios.forEach((radio) => {
      radio.addEventListener('change', function () {
        updateQuantity();
      });
    });
  }

  const variantSelect = document.querySelector('[data-prodify-variant-select]');
  if (variantSelect) {
    variantSelect.addEventListener('change', function () {
      updateQuantity();
    });
  }
});

</script>

<style>
  input[type='radio'].disabled + label {
    text-decoration: line-through;
  }

  .section-main-product .product-title {
    font-size: 32px;
    line-height: 48px;
    font-weight: 700;
  }

  .section-main-product .shopify-section-main-product-inner .media {
    width: 100%;
    flex: 2 1 400px;
  }

  .section-main-product .shopify-section-main-product-inner .media .image-wrapper {
    position: relative;
    width: 100%;
  }

  .section-main-product .shopify-section-main-product-inner .media .image-wrapper img {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .section-main-product .shopify-section-main-product-inner .info {
    flex: 1 1 300px;
  }

  .section-main-product .shopify-section-main-product-inner .info .caption {
    letter-spacing: 1.3px;
    font-size: 10px;
    line-height: 12px;
    color: rgba(26, 27, 24, 0.75);
  }

  .section-main-product .shopify-section-main-product-inner .info dl dd {
    letter-spacing: 1.3px;
    font-size: 18px;
    line-height: 27px;
    font-weight: 400;
    margin: 15px auto;
  }

  .section-main-product .shopify-section-main-product-inner .info fieldset {
    margin-bottom: 20px;
    display: flex;
    /* flex-wrap: wrap; */
    gap: 8px;
  }

  .section-main-product .shopify-section-main-product-inner .info fieldset span.additional_variant_text {
    font-size: 10px;
    text-transform: uppercase;
    text-align: center;
  }

  .section-main-product .shopify-section-main-product-inner .info fieldset legend {
    font-size: 13px;
    letter-spacing: 0.4px;
    line-height: 19.5px;
    color: rgba(26, 27, 24, 0.75);
    margin-bottom: 16px;
  }

  .section-main-product .shopify-section-main-product-inner .info fieldset label {
    /* display: inline-block; */
    padding: 10px 20px;
    border-radius: 40px;
    letter-spacing: 1px;
    font-size: 22px;
    font-weight: bold ;
    cursor: pointer;
    width: 125px;
    height: 86px;
    border: 1px solid #EDEDED;
  }

  .section-main-product .shopify-section-main-product-inner .info fieldset input:checked+label {
      background-color: #D8E303;
      border: none;
  }

  body:not(.using-mouse) .section-main-product .shopify-section-main-product-inner .info fieldset input:focus + label {
    outline: #08f auto 2px;
  }

  .section-main-product .shopify-section-main-product-inner .info fieldset label[data-unavailable='true'],
  .section-main-product .shopify-section-main-product-inner .info fieldset input[disabled] + label {
    background-color: transparent;
    color: lightgray;
  }

  .line-through {
    color: #D57D00;
  }

  .quantity-row {
    text-transform: uppercase;
    font-size: 15px;
}

  .section-main-product .shopify-section-main-product-inner .info .quantity-row label {
    display: block;
    font-size: 13px;
    letter-spacing: 0.4px;
    line-height: 19.5px;
    color: rgba(26, 27, 24, 0.75);
    margin-bottom: 4px;
  }

  .section-main-product .shopify-section-main-product-inner .info .quantity-row .quantity-control-container {
    display: flex;
    align-items: center;
    max-width: max-content;
    font-size: 22px;
  }

  .section-main-product .shopify-section-main-product-inner .info .quantity-row .quantity-control-container button {
    width: 45px;
    height: 45px;
    appearance: none;
    -webkit-appearance: none;
    background: transparent;
    border: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 22px;
  }

  .section-main-product .shopify-section-main-product-inner .info .quantity-row .quantity-control-container button svg {
    width: 14px;
  }

  .section-main-product .shopify-section-main-product-inner .info .quantity-row .quantity-control-container input {
    appearance: none;
    -webkit-appearance: none;
    border: none;
    pointer-events: none;
    width: 48px;
    text-align: center;
    padding: 0;
  }

  .section-main-product
    .shopify-section-main-product-inner
    .info
    .quantity-row
    .quantity-control-container
    input[type='number']::-webkit-inner-spin-button,
  .section-main-product
    .shopify-section-main-product-inner
    .info
    .quantity-row
    .quantity-control-container
    input[type='number']::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .gap-1{
    gap: 5px;
  }

  .mb-\[35px\] {
    margin-bottom: 35px;
  }

  .text-15px {
    font-size: 15px;
  }

  .description li {
  list-style: none; /* Remove default marker */
  position: relative; /* Allow positioning of the marker */
  padding-left: 25px; /* Add space for the custom marker */
}

.description li::before {
  content: '';
    position: absolute;
    left: -20px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    background-image: url("https://cdn.shopify.com/s/files/1/0793/1664/8249/files/bullet.png?v=1733621837");
    background-size: contain;
    background-repeat: no-repeat;
}

@media screen and (max-width: 768px) {
  .section-main-product .shopify-section-main-product-inner .info fieldset {
    flex-wrap: wrap;
    justify-content: center;
  }
}
</style>
