{"version":3,"file":"prodify.bbca58c6.min.js","sources":["../frontend/js/prodify.js"],"sourcesContent":["class Prodify {\n  constructor(settings) {\n    this.settings = {\n      ...settings,\n    };\n\n    this.el = document.querySelector(\"[data-prodify]\");\n    this.pickerType = this.el.dataset.prodify;\n\n    this.selectors = {\n      priceContainer: \"[data-prodify-price-container]\",\n      mediaContainer: \"[data-prodify-media-container]\",\n      variantsJson: \"[data-prodify-variants-json]\",\n      optionContainer: \"[data-prodify-option-container]\",\n      productForm: \"[data-prodify-product-form]\",\n      quantityIncrement: \"[data-prodify-quantity-increment]\",\n      quantityDecrement: \"[data-prodify-quantity-decrement]\",\n      quantityPresentation: \"[data-prodify-quantity-presentation]\",\n    };\n\n    this.textStrings = {\n      addToCart: window.variantStrings.addToCart,\n      unavailableVariantValueLabel:\n        window.variantStrings.unavailable_with_option,\n      soldOutVariantValueLabel: window.variantStrings.soldout_with_option,\n      addButtonTextUnavailable: window.variantStrings.unavailable,\n    };\n\n    this.quantityIncrementButton = this.el.querySelector(\n      this.selectors.quantityIncrement\n    );\n    this.quantityDecrementButton = this.el.querySelector(\n      this.selectors.quantityDecrement\n    );\n    this.quantityPresentationInput = this.el.querySelector(\n      this.selectors.quantityPresentation\n    );\n    this.quantityHiddenInput = this.el.querySelector('input[name=\"quantity\"]');\n\n    this.initEventListeners();\n  }\n\n  initEventListeners = () => {\n    this.el.addEventListener(\"change\", this.onVariantChange);\n\n    if (\n      this.quantityIncrementButton &&\n      this.quantityDecrementButton &&\n      this.quantityPresentationInput\n    ) {\n      this.quantityIncrementButton.addEventListener(\"click\", () => {\n        this.updateQuantity(\"up\");\n      });\n\n      this.quantityDecrementButton.addEventListener(\"click\", () => {\n        this.updateQuantity(\"down\");\n      });\n    }\n  };\n\n  updateCurrentVariant = () => {\n    const variants = this.getVariantData();\n    const matchingVariant = variants.find((variant) => {\n      return variant.options.every((option, index) => {\n        return this.options[index] === option;\n      });\n    });\n    this.currentVariant = matchingVariant;\n  };\n\n  updateQuantity = (stepDirection) => {\n    const previousQuantity = parseInt(this.quantityPresentationInput.value);\n\n    if (stepDirection == \"up\") {\n      this.quantityHiddenInput.value = this.quantityPresentationInput.value =\n        previousQuantity + 1;\n    } else {\n      this.quantityHiddenInput.value = this.quantityPresentationInput.value =\n        Math.max(1, previousQuantity - 1);\n    }\n  };\n\n  updateCurrentOptions = () => {\n    if (this.pickerType == \"select\") {\n      this.options = Array.from(\n        this.el.querySelectorAll(\"select\"),\n        (select) => select.value\n      );\n      return;\n    }\n\n    this.optionContainers = Array.from(\n      this.el.querySelectorAll(this.selectors.optionContainer)\n    );\n    this.options = this.optionContainers.map((optionContainer) => {\n      return Array.from(optionContainer.querySelectorAll(\"input\")).find(\n        (radio) => radio.checked\n      ).value;\n    });\n  };\n\n  updateVariantIdInput() {\n    const productForms = document.querySelectorAll(this.selectors.productForm);\n    productForms.forEach((productForm) => {\n      const input = productForm.querySelector('input[name=\"id\"]');\n      input.value = this.currentVariant.id;\n      // input.dispatchEvent(new Event('change', { bubbles: true }));\n    });\n  }\n\n  updateURL() {\n    if (!this.currentVariant || this.el.dataset.updateUrl === \"false\") return;\n    window.history.replaceState(\n      {},\n      \"\",\n      `${this.el.dataset.url}?variant=${this.currentVariant.id}`\n    );\n  }\n\n  updateAddButtonDom(disable = true, text, modifyClass = true) {\n    const productForm = document.querySelector(this.selectors.productForm);\n    if (!productForm) return;\n    const addButton = productForm.querySelector('[name=\"add\"]');\n    const addButtonText = productForm.querySelector('[name=\"add\"] > span');\n    if (!addButton) return;\n\n    if (disable) {\n      addButton.setAttribute(\"disabled\", \"disabled\");\n      if (text) addButtonText.textContent = text;\n    } else {\n      addButton.removeAttribute(\"disabled\");\n      addButtonText.textContent = this.textStrings.addButtonTextUnavailable;\n    }\n\n    if (!modifyClass) return;\n\n    if (disable) {\n      addButton.classList.add(\"disabled\");\n    } else {\n      addButton.classList.remove(\"disabled\");\n    }\n  }\n\n  onVariantChange = (event) => {\n    this.updateCurrentOptions();\n    this.updateCurrentVariant();\n    this.updateAddButtonDom(true, \"\", false);\n    this.compareInputValues();\n    this.setOptionSelected(event.target);\n\n    if (!this.currentVariant) {\n      this.updateAddButtonDom(\n        true,\n        this.textStrings.addButtonTextUnavailable,\n        true\n      );\n    } else {\n      this.updateURL();\n      this.updateVariantIdInput();\n      this.swapProductInfo();\n    }\n  };\n\n  setOptionSelected(select) {\n    if (this.pickerType == \"select\") {\n      const options = Array.from(select.querySelectorAll(\"option\"));\n      const currentValue = select.value;\n\n      options.forEach((option) => {\n        if (option.value === currentValue) {\n          option.setAttribute(\"selected\", \"selected\");\n        } else {\n          option.removeAttribute(\"selected\");\n        }\n      });\n    }\n  }\n\n  compareInputValues() {\n    const variantsMatchingOptionOneSelected = this.variantData.filter(\n      // Grab the first checked input and compare it to the variant option1\n      // return an array of variants where the option1 matches the checked input\n      (variant) => this.el.querySelector(\":checked\").value === variant.option1\n    );\n\n    const inputWrappers = [\n      ...this.el.querySelectorAll(this.selectors.optionContainer),\n    ];\n    inputWrappers.forEach((option, index) => {\n      if (index === 0) return;\n      const optionInputs = [\n        ...option.querySelectorAll('input[type=\"radio\"], option'),\n      ];\n      const previousOptionSelected =\n        inputWrappers[index - 1].querySelector(\":checked\").value;\n      const availableOptionInputsValues = variantsMatchingOptionOneSelected\n        .filter(\n          //\n          (variant) =>\n            variant.available &&\n            variant[`option${index}`] === previousOptionSelected\n        )\n        .map((variantOption) => variantOption[`option${index + 1}`]);\n\n      const existingOptionInputsValues = variantsMatchingOptionOneSelected\n        .filter(\n          //\n          (variant) => variant[`option${index}`] === previousOptionSelected\n        )\n        .map((variantOption) => variantOption[`option${index + 1}`]);\n\n      this.setInputAvailability(\n        optionInputs,\n        availableOptionInputsValues,\n        existingOptionInputsValues\n      );\n    });\n  }\n\n  setInputAvailability(\n    optionInputs,\n    availableOptionInputValues,\n    existingOptionInputsValues\n  ) {\n    optionInputs.forEach((input) => {\n      if (availableOptionInputValues.includes(input.getAttribute(\"value\"))) {\n        if (this.pickerType == \"select\") {\n          input.innerText = input.getAttribute(\"value\");\n          return;\n        }\n        input.classList.remove(\"disabled\");\n      } else {\n        if (existingOptionInputsValues.includes(input.getAttribute(\"value\"))) {\n          if (this.pickerType == \"select\") {\n            input.innerText = this.textStrings.soldOutVariantValueLabel.replace(\n              \"[value]\",\n              input.getAttribute(\"value\")\n            );\n            return;\n          }\n          input.classList.add(\"disabled\");\n        } else {\n          if (this.pickerType == \"select\") {\n            input.innerText =\n              this.textStrings.unavailableVariantValueLabel.replace(\n                \"[value]\",\n                input.getAttribute(\"value\")\n              );\n            return;\n          }\n          input.classList.add(\"disabled\");\n        }\n      }\n    });\n  }\n\n  swapProductInfo = () => {\n    window.slayed.helpers\n      .fetchHTML(\n        `${this.el.dataset.url}?variant=${this.currentVariant.id}&section_id=${this.el.dataset.section}`\n      )\n      .then((responseHTML) => {\n        const priceSource = responseHTML.querySelector(\n          this.selectors.priceContainer\n        );\n        const priceTarget = this.el.querySelector(\n          this.selectors.priceContainer\n        );\n        const mediaSource = responseHTML.querySelector(\n          this.selectors.mediaContainer\n        );\n        const mediaTarget = this.el.querySelector(\n          this.selectors.mediaContainer\n        );\n        const addButtonSource = responseHTML.querySelector(\n          `${this.selectors.productForm} [name=\"add\"]`\n        );\n        const addButtonTarget = this.el.querySelector(\n          `${this.selectors.productForm} [name=\"add\"]`\n        );\n\n        if (priceSource && priceTarget) {\n          priceTarget.replaceWith(priceSource);\n        }\n\n        if (mediaSource && mediaTarget) {\n          mediaTarget.replaceWith(mediaSource);\n        }\n\n        if (addButtonSource && addButtonTarget) {\n          addButtonTarget.replaceWith(addButtonSource);\n        }\n      });\n  };\n\n  getVariantData = () => {\n    this.variantData =\n      this.variantData ||\n      JSON.parse(\n        this.el.querySelector(this.selectors.variantsJson).textContent\n      );\n    return this.variantData;\n  };\n}\n\nwindow.prodify = new Prodify();\n"],"names":["Prodify","settings","__publicField","matchingVariant","variant","option","index","stepDirection","previousQuantity","select","optionContainer","radio","event","responseHTML","priceSource","priceTarget","mediaSource","mediaTarget","addButtonSource","addButtonTarget","productForm","input","disable","text","modifyClass","addButton","addButtonText","options","currentValue","variantsMatchingOptionOneSelected","inputWrappers","optionInputs","previousOptionSelected","availableOptionInputsValues","variantOption","existingOptionInputsValues","availableOptionInputValues"],"mappings":"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"}